<!--
  Copyright (C) 2016-2020 TU Muenchen and contributors of ANEXIA Internetdienstleistungs GmbH
  SPDX-License-Identifier: AGPL-3.0-or-later
-->

<ng-container *transloco="let t">
  <div class="h-100 w-100 bell-button position-relative" dropdown container="body" placement="bottom right">
    <button
      type="button"
      id="notifications-dropdown-button"
      class="btn ewb-button-regular"
      aria-controls="notifications-dropdown-menu"
      dropdownToggle
    >
      <span
        *ngIf="notificationService.hasUnread"
        class="badge badge-pill badge-warning d-inline-block position-absolute p-1 badge-bell"
      ></span>
      <eworkbench-icon className="wb-bell"></eworkbench-icon>
    </button>

    <ul
      *dropdownMenu
      id="notifications-list"
      class="dropdown-menu dropdown-menu-right details-dropdown-menu notifications-dropdown-menu"
      role="menu"
      aria-labelledby="notifications-dropdown-menu"
    >
      <div class="results-container restrict-notifications-container pt-1">
        <div>
          <div class="font-weight-bold ml-2 mb-2">{{ t('navbar.globalNotifications.unread') }}</div>
          <ng-container *ngIf="!unreadNotifications.length">
            <li class="btn ewb-button-regular font-weight-normal w-100 text-left cursor-default">
              {{ t('navbar.globalNotifications.noUnread') }}
            </li>
          </ng-container>
          <ng-container *ngIf="unreadNotifications.length">
            <ng-container *ngFor="let notification of unreadNotifications">
              <li role="menuitem" class="btn ewb-button-regular font-weight-normal w-100 text-left menu-item-button unread-item-button">
                <eworkbench-icon
                  [className]="notification.content_type_model | formatContentTypeModel: 'icon'"
                  class="mr-1"
                ></eworkbench-icon>
                <a
                  [routerLink]="[notification.content_type_model | formatContentTypeModel: 'routerBaseLink', notification.object_id]"
                  (click)="onRead(notification)"
                >
                  {{ notification.title }}
                </a>
              </li>
            </ng-container>
          </ng-container>
          <div class="font-weight-bold ml-2 my-2">{{ t('navbar.globalNotifications.older') }}</div>
          <ng-container *ngIf="!oldNotifications.length">
            <li class="btn ewb-button-regular font-weight-normal w-100 text-left cursor-default">
              {{ t('navbar.globalNotifications.noNotifications') }}
            </li>
          </ng-container>
          <ng-container *ngIf="oldNotifications.length">
            <ng-container *ngFor="let notification of oldNotifications">
              <li role="menuitem" class="btn ewb-button-regular font-weight-normal w-100 text-left menu-item-button">
                <eworkbench-icon
                  [className]="notification.content_type_model | formatContentTypeModel: 'icon'"
                  class="mr-1"
                ></eworkbench-icon>
                <a [routerLink]="[notification.content_type_model | formatContentTypeModel: 'routerBaseLink', notification.object_id]">
                  {{ notification.title }}
                </a>
              </li>
            </ng-container>
          </ng-container>
        </div>
        <div class="footer mt-2">
          <a class="ml-2" [routerLink]="['/notifications']" routerLinkActive="active">
            {{ t('navbar.globalNotifications.showAll') }}
          </a>
          <div *ngIf="notificationService.hasUnread" class="ml-2 cursor-pointer" (click)="onReadAll()">
            {{ t('navbar.globalNotifications.markAllAsRead') }}
          </div>
        </div>
      </div>
    </ul>
  </div>
</ng-container>
