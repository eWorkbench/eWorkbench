<!--
  Copyright (C) 2016-2020 TU Muenchen and contributors of ANEXIA Internetdienstleistungs GmbH
  SPDX-License-Identifier: AGPL-3.0-or-later
-->

<ng-container *transloco="let t">
  <div #searchDropdown="bs-dropdown" dropdown container="body" placement="bottom right" [insideClick]="true">
    <form [formGroup]="form">
      <div class="input-group search-input-group">
        <input
          #searchInput
          type="text"
          id="search-input"
          aria-controls="results-list"
          class="form-control ewb-input"
          formControlName="search"
          [placeholder]="t('navbar.globalSearch.placeholder')"
          autocomplete="off"
          dropdownToggle
        />
        <button type="button" class="btn btn-sm bg-transparent clear-input" *ngIf="!f.search.value">
          <eworkbench-icon className="wb-search"></eworkbench-icon>
        </button>
        <button type="button" class="btn btn-sm bg-transparent clear-input" (click)="resetSearch()" *ngIf="f.search.value">
          <eworkbench-icon className="wb-remove"></eworkbench-icon>
        </button>
      </div>
      <ul
        *dropdownMenu
        id="results-list"
        class="dropdown-menu dropdown-menu-right details-dropdown-menu search-dropdown-menu"
        role="menu"
        aria-labelledby="search-input"
      >
        <div class="d-flex">
          <div class="d-flex flex-column justify-content-between restrict-search-container pt-1">
            <div>
              <div class="font-weight-bold ml-2 mb-2">{{ t('navbar.globalSearch.restrictSearch') }}</div>
              <div class="btn ewb-button-regular font-weight-normal w-100 text-left menu-item-button">
                <div class="custom-control custom-checkbox">
                  <input
                    type="checkbox"
                    class="custom-control-input"
                    id="search-appointment"
                    name="search-appointment"
                    formControlName="appointment"
                    (change)="onChangeFilter($event, 'shared_elements.meeting')"
                  />
                  <label class="custom-control-label w-100 font-weight-normal" for="search-appointment">
                    <eworkbench-icon [className]="'shared_elements.meeting' | formatContentTypeModel: 'icon'"></eworkbench-icon>
                    {{ 'shared_elements.meeting' | formatContentTypeModel: 'translation' }}
                  </label>
                </div>
              </div>
              <div class="btn ewb-button-regular font-weight-normal w-100 text-left menu-item-button">
                <div class="custom-control custom-checkbox">
                  <input
                    type="checkbox"
                    class="custom-control-input"
                    id="search-note"
                    name="search-note"
                    formControlName="note"
                    (change)="onChangeFilter($event, 'shared_elements.note')"
                  />
                  <label class="custom-control-label w-100 font-weight-normal" for="search-note">
                    <eworkbench-icon [className]="'shared_elements.note' | formatContentTypeModel: 'icon'"></eworkbench-icon>
                    {{ 'shared_elements.note' | formatContentTypeModel: 'translation' }}
                  </label>
                </div>
              </div>
              <div class="btn ewb-button-regular font-weight-normal w-100 text-left menu-item-button">
                <div class="custom-control custom-checkbox">
                  <input
                    type="checkbox"
                    class="custom-control-input"
                    id="search-contact"
                    name="search-contact"
                    formControlName="contact"
                    (change)="onChangeFilter($event, 'shared_elements.contact')"
                  />
                  <label class="custom-control-label w-100 font-weight-normal" for="search-contact">
                    <eworkbench-icon [className]="'shared_elements.contact' | formatContentTypeModel: 'icon'"></eworkbench-icon>
                    {{ 'shared_elements.contact' | formatContentTypeModel: 'translation' }}
                  </label>
                </div>
              </div>
              <div class="btn ewb-button-regular font-weight-normal w-100 text-left menu-item-button">
                <div class="custom-control custom-checkbox">
                  <input
                    type="checkbox"
                    class="custom-control-input"
                    id="search-dmp"
                    name="search-dmp"
                    formControlName="dmp"
                    (change)="onChangeFilter($event, 'dmp.dmp')"
                  />
                  <label class="custom-control-label w-100 font-weight-normal" for="search-dmp">
                    <eworkbench-icon [className]="'dmp.dmp' | formatContentTypeModel: 'icon'"></eworkbench-icon>
                    {{ 'dmp.dmp' | formatContentTypeModel: 'translation' }}
                  </label>
                </div>
              </div>
              <div class="btn ewb-button-regular font-weight-normal w-100 text-left menu-item-button">
                <div class="custom-control custom-checkbox">
                  <input
                    type="checkbox"
                    class="custom-control-input"
                    id="search-dss"
                    name="search-dss"
                    formControlName="dss"
                    (change)="onChangeFilter($event, 'dss.dsscontainer')"
                  />
                  <label class="custom-control-label w-100 font-weight-normal" for="search-dss">
                    <eworkbench-icon [className]="'dss.dsscontainer' | formatContentTypeModel: 'icon'"></eworkbench-icon>
                    {{ 'dss.dsscontainer' | formatContentTypeModel: 'translation' }}
                  </label>
                </div>
              </div>
              <div class="btn ewb-button-regular font-weight-normal w-100 text-left menu-item-button">
                <div class="custom-control custom-checkbox">
                  <input
                    type="checkbox"
                    class="custom-control-input"
                    id="search-file"
                    name="search-file"
                    formControlName="file"
                    (change)="onChangeFilter($event, 'shared_elements.file')"
                  />
                  <label class="custom-control-label w-100 font-weight-normal" for="search-file">
                    <eworkbench-icon [className]="'shared_elements.file' | formatContentTypeModel: 'icon'"></eworkbench-icon>
                    {{ 'shared_elements.file' | formatContentTypeModel: 'translation' }}
                  </label>
                </div>
              </div>
              <div class="btn ewb-button-regular font-weight-normal w-100 text-left menu-item-button">
                <div class="custom-control custom-checkbox">
                  <input
                    type="checkbox"
                    class="custom-control-input"
                    id="search-labbook"
                    name="search-labbook"
                    formControlName="labbook"
                    (change)="onChangeFilter($event, 'labbooks.labbook')"
                  />
                  <label class="custom-control-label w-100 font-weight-normal" for="search-labbook">
                    <eworkbench-icon [className]="'labbooks.labbook' | formatContentTypeModel: 'icon'"></eworkbench-icon>
                    {{ 'labbooks.labbook' | formatContentTypeModel: 'translation' }}
                  </label>
                </div>
              </div>
              <div class="btn ewb-button-regular font-weight-normal w-100 text-left menu-item-button">
                <div class="custom-control custom-checkbox">
                  <input
                    type="checkbox"
                    class="custom-control-input"
                    id="search-picture"
                    name="search-picture"
                    formControlName="picture"
                    (change)="onChangeFilter($event, 'pictures.picture')"
                  />
                  <label class="custom-control-label w-100 font-weight-normal" for="search-picture">
                    <eworkbench-icon [className]="'pictures.picture' | formatContentTypeModel: 'icon'"></eworkbench-icon>
                    {{ 'pictures.picture' | formatContentTypeModel: 'translation' }}
                  </label>
                </div>
              </div>
              <div class="btn ewb-button-regular font-weight-normal w-100 text-left menu-item-button">
                <div class="custom-control custom-checkbox">
                  <input
                    type="checkbox"
                    class="custom-control-input"
                    id="search-plugin"
                    name="search-plugin"
                    formControlName="plugin"
                    (change)="onChangeFilter($event, 'plugins.plugininstance')"
                  />
                  <label class="custom-control-label w-100 font-weight-normal" for="search-plugin">
                    <eworkbench-icon [className]="'plugins.plugininstance' | formatContentTypeModel: 'icon'"></eworkbench-icon>
                    {{ 'plugins.plugininstance' | formatContentTypeModel: 'translation' }}
                  </label>
                </div>
              </div>
              <div class="btn ewb-button-regular font-weight-normal w-100 text-left menu-item-button">
                <div class="custom-control custom-checkbox">
                  <input
                    type="checkbox"
                    class="custom-control-input"
                    id="search-project"
                    name="search-project"
                    formControlName="project"
                    (change)="onChangeFilter($event, 'projects.project')"
                  />
                  <label class="custom-control-label w-100 font-weight-normal" for="search-project">
                    <eworkbench-icon [className]="'projects.project' | formatContentTypeModel: 'icon'"></eworkbench-icon>
                    {{ 'projects.project' | formatContentTypeModel: 'translation' }}
                  </label>
                </div>
              </div>
              <div class="btn ewb-button-regular font-weight-normal w-100 text-left menu-item-button">
                <div class="custom-control custom-checkbox">
                  <input
                    type="checkbox"
                    class="custom-control-input"
                    id="search-resource"
                    name="search-resource"
                    formControlName="resource"
                    (change)="onChangeFilter($event, 'projects.resource')"
                  />
                  <label class="custom-control-label w-100 font-weight-normal" for="search-resource">
                    <eworkbench-icon [className]="'projects.resource' | formatContentTypeModel: 'icon'"></eworkbench-icon>
                    {{ 'projects.resource' | formatContentTypeModel: 'translation' }}
                  </label>
                </div>
              </div>
              <div class="btn ewb-button-regular font-weight-normal w-100 text-left menu-item-button">
                <div class="custom-control custom-checkbox">
                  <input
                    type="checkbox"
                    class="custom-control-input"
                    id="search-drive"
                    name="search-drive"
                    formControlName="drive"
                    (change)="onChangeFilter($event, 'drives.drive')"
                  />
                  <label class="custom-control-label w-100 font-weight-normal" for="search-drive">
                    <eworkbench-icon [className]="'drives.drive' | formatContentTypeModel: 'icon'"></eworkbench-icon>
                    {{ 'drives.drive' | formatContentTypeModel: 'translation' }}
                  </label>
                </div>
              </div>
              <div class="btn ewb-button-regular font-weight-normal w-100 text-left menu-item-button">
                <div class="custom-control custom-checkbox">
                  <input
                    type="checkbox"
                    class="custom-control-input"
                    id="search-task"
                    name="search-task"
                    formControlName="task"
                    (change)="onChangeFilter($event, 'shared_elements.task')"
                  />
                  <label class="custom-control-label w-100 font-weight-normal" for="search-task">
                    <eworkbench-icon [className]="'shared_elements.task' | formatContentTypeModel: 'icon'"></eworkbench-icon>
                    {{ 'shared_elements.task' | formatContentTypeModel: 'translation' }}
                  </label>
                </div>
              </div>
              <div class="btn ewb-button-regular font-weight-normal w-100 text-left menu-item-button">
                <div class="custom-control custom-checkbox">
                  <input
                    type="checkbox"
                    class="custom-control-input"
                    id="search-taskboard"
                    name="search-taskboard"
                    formControlName="taskboard"
                    (change)="onChangeFilter($event, 'kanban_boards.kanbanboard')"
                  />
                  <label class="custom-control-label w-100 font-weight-normal" for="search-taskboard">
                    <eworkbench-icon [className]="'kanban_boards.kanbanboard' | formatContentTypeModel: 'icon'"></eworkbench-icon>
                    {{ 'kanban_boards.kanbanboard' | formatContentTypeModel: 'translation' }}
                  </label>
                </div>
              </div>
            </div>
            <div class="metadata-search cursor-pointer">
              <a class="ml-2" [routerLink]="['/metadata-search']" routerLinkActive="active" (click)="hideDropdown()">
                {{ t('navbar.globalSearch.metadataSearch') }}
              </a>
            </div>
          </div>
          <ng-container *ngIf="searchText">
            <eworkbench-loading class="loading" [loading]="loading">
              <div class="results-container">
                <ng-container *ngFor="let result of results">
                  <a
                    [routerLink]="[result.content_type_model | formatContentTypeModel: 'routerBaseLink', result.pk]"
                    (click)="hideDropdown()"
                  >
                    <li role="menuitem" class="btn ewb-button-regular text-left h-auto w-100 pt-1 pb-1 border-bottom menu-item">
                      <div class="d-flex">
                        <eworkbench-icon
                          [className]="result.content_type_model | formatContentTypeModel: 'icon'"
                          class="result-icon align-self-center"
                        ></eworkbench-icon>
                        <div class="ml-2">
                          <div class="result-name text-truncate">{{ result.display }}</div>
                          <div class="d-flex text-nowrap font-weight-normal">
                            {{ t('navbar.globalSearch.createdBy') }}
                            <eworkbench-user-details [user]="result.created_by" [modal]="false" class="ml-1"></eworkbench-user-details>
                          </div>
                        </div>
                      </div>
                    </li>
                  </a>
                </ng-container>
              </div>
            </eworkbench-loading>
          </ng-container>
        </div>
      </ul>
    </form>
  </div>
</ng-container>
