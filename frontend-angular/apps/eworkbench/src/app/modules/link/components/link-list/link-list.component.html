<!--
  Copyright (C) 2016-2020 TU Muenchen and contributors of ANEXIA Internetdienstleistungs GmbH
  SPDX-License-Identifier: AGPL-3.0-or-later
-->

<ng-container *ngIf="!initialLoading">
  <ng-container *transloco="let t">
    <eworkbench-loading [loading]="loading">
      <div class="link-tools mb-2 text-right">
        <ng-select
          class="btn ewb-select inline-block text-left"
          [placeholder]="t('linkList.filterLinks')"
          [items]="dropdownContentTypes"
          (change)="onChangeFilterContentType($event)"
        ></ng-select>
      </div>
      <eworkbench-table-view
        #tableView
        [columns]="listColumns"
        [service]="service"
        [params]="params"
        [customId]="id"
        [sort]="1"
        sortBy="created_at"
        [relation]="true"
        [skeletonLines]="12"
        [paginationSize]="12"
      ></eworkbench-table-view>
    </eworkbench-loading>
  </ng-container>
</ng-container>

<ng-template #titleCellTemplate let-row>
  <ng-container *ngIf="row.right_object_id === id">
    <div ellipsis="190" [tooltip]="row.left_content_object.display" containerClass="tooltip-sm" [delay]="500">
      <eworkbench-icon
        [className]="row.left_content_object.content_type_model | formatContentTypeModel: 'icon'"
        class="mr-2"
      ></eworkbench-icon>
      <a
        [routerLink]="[row.left_content_object.content_type_model | formatContentTypeModel: 'routerBaseLink', row.left_content_object.pk]"
        >{{ row.left_content_object.display }}</a
      >
    </div>
  </ng-container>
  <ng-container *ngIf="row.left_object_id === id && row.right_object_id !== id">
    <div ellipsis="190" [tooltip]="row.right_content_object.display" containerClass="tooltip-sm" [delay]="500">
      <eworkbench-icon
        [className]="row.right_content_object.content_type_model | formatContentTypeModel: 'icon'"
        class="mr-2"
      ></eworkbench-icon>
      <a
        [routerLink]="[row.right_content_object.content_type_model | formatContentTypeModel: 'routerBaseLink', row.right_content_object.pk]"
        >{{ row.right_content_object.display }}</a
      >
    </div>
  </ng-container>
</ng-template>
<ng-template #typeCellTemplate let-row>
  <ng-container *ngIf="row.right_object_id === id">
    {{ row.left_content_object.content_type_model | formatContentTypeModel }}
  </ng-container>
  <ng-container *ngIf="row.left_object_id === id && row.right_object_id !== id">
    {{ row.right_content_object.content_type_model | formatContentTypeModel }}
  </ng-container>
</ng-template>
<ng-template #linkedByCellTemplate let-row>
  <eworkbench-user-details [user]="row.created_by"></eworkbench-user-details>
</ng-template>
<ng-template #linkedAtCellTemplate let-row>
  <div class="whitespace-nowrap">
    {{ row.created_at | formatDate }}
  </div>
</ng-template>
<ng-template #actionsCellTemplate let-row>
  <ng-container *transloco="let t">
    <div class="text-right whitespace-nowrap" *ngIf="currentUser?.pk === row.created_by.pk">
      <button type="button" class="btn ewb-button-small mr-2" (click)="onChangePrivateState(row)" [disabled]="loading">
        <eworkbench-icon
          *ngIf="row.private"
          className="wb-locked"
          [tooltip]="t('linkList.privateLink.tooltip')"
          containerClass="tooltip-sm"
        ></eworkbench-icon>
        <eworkbench-icon
          *ngIf="!row.private"
          className="wb-unlock"
          [tooltip]="t('linkList.publicLink.tooltip')"
          containerClass="tooltip-sm"
        ></eworkbench-icon>
      </button>
      <button type="button" class="btn ewb-button-small" (click)="onOpenDeleteModal(row)" [disabled]="loading">
        <eworkbench-icon className="wb-remove" [tooltip]="t('linkList.deleteLink.tooltip')" containerClass="tooltip-sm"></eworkbench-icon>
      </button>
    </div>
  </ng-container>
</ng-template>
