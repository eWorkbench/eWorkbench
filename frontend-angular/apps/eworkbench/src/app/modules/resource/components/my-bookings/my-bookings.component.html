<!--
  Copyright (C) 2016-2020 TU Muenchen and contributors of ANEXIA Internetdienstleistungs GmbH
  SPDX-License-Identifier: AGPL-3.0-or-later
-->

<ng-container *transloco="let t">
  <div class="d-flex justify-content-between mt-3 mb-1">
    <label class="label-text">{{ t('resources.myBookings.header') }}</label>

    <div>
      <button class="btn ewb-button-big ewb-button-primary" [disabled]="loading" (click)="onExportMany()" *ngIf="tableView.data?.length">
        {{ t('resources.myBookings.export') }}
      </button>

      <div class="custom-control custom-checkbox d-inline-block ml-3">
        <input
          class="custom-control-input"
          type="checkbox"
          id="hidePastBookings"
          name="hidePastBookings"
          [formControl]="hidePastBookings"
          (change)="onToogleHidePastBookings()"
        />
        <label class="custom-control-label" for="hidePastBookings">{{ t('resources.myBookings.hidePastBookings.label') }}</label>
      </div>
    </div>
  </div>

  <eworkbench-table-manage-columns
    class="d-flex justify-content-end mb-3"
    [columns]="listColumns"
    [defaultColumns]="defaultColumns"
    (columnsChanged)="onColumnsChanged($event)"
  ></eworkbench-table-manage-columns>
  <eworkbench-table-view
    #tableView
    [columns]="listColumns"
    [service]="myResourceBookingsService"
    [params]="serviceParams"
    [sortBy]="sorting?.key"
    [sort]="sorting?.direction"
    (orderChanged)="onColumnsChanged($event)"
    (sortChanged)="onSortChanged($event)"
    (rendered)="onRenderFinish()"
  ></eworkbench-table-view>
</ng-container>

<ng-template #nameCellTemplate let-row>
  <eworkbench-ellipsis-element [maxWidth]="300">
    {{ row.resource.display }}
  </eworkbench-ellipsis-element>
</ng-template>
<ng-template #typeCellTemplate let-row>
  <eworkbench-resource-type [type]="row.resource.type"></eworkbench-resource-type>
</ng-template>
<ng-template #descriptionCellTemplate let-row>
  <eworkbench-ellipsis-element maxWidth="350">
    {{ row.resource.description | stripHTML }}
  </eworkbench-ellipsis-element>
</ng-template>
<ng-template #appointmentCellTemplate let-row>
  <eworkbench-ellipsis-element [maxWidth]="300">
    <a [routerLink]="['/appointments', row.pk]">{{ row.display }}</a>
  </eworkbench-ellipsis-element>
</ng-template>
<ng-template #appointmentDescriptionCellTemplate let-row>
  <eworkbench-ellipsis-element maxWidth="350">
    {{ row.text | stripHTML }}
  </eworkbench-ellipsis-element>
</ng-template>
<ng-template #attendingUsersCellTemplate let-row>
  <eworkbench-users-grouping [users]="row.attending_users"></eworkbench-users-grouping>
</ng-template>
<ng-template #dateTimeStartCellTemplate let-row>
  {{ row.date_time_start | formatDate }}
</ng-template>
<ng-template #dateTimeEndCellTemplate let-row>
  {{ row.date_time_end | formatDate }}
</ng-template>
<ng-template #createdAtCellTemplate let-row>
  {{ row.created_at | formatDate }}
</ng-template>
<ng-template #createdByCellTemplate let-row>
  <eworkbench-user-details [user]="row.created_by"></eworkbench-user-details>
</ng-template>
<ng-template #actionsCellTemplate let-row>
  <ng-container *transloco="let t">
    <div class="text-right">
      <eworkbench-favorite-button
        class="d-inline-block mr-2"
        [id]="row.pk"
        [contentType]="row.content_type"
        [favorited]="row.is_favourite"
      ></eworkbench-favorite-button>
      <button
        class="btn ewb-button-small mr-2"
        [disabled]="loading"
        [tooltip]="t('exportButton.tooltip')"
        containerClass="tooltip-sm"
        (click)="onExport(row.pk)"
      >
        <eworkbench-icon className="wb-download"></eworkbench-icon>
      </button>
      <eworkbench-trash-button
        class="d-inline-block mr-2"
        [service]="myResourceBookingsService"
        [id]="row.pk"
        [tableView]="tableView"
        [loading]="loading"
      ></eworkbench-trash-button>
      <button class="btn ewb-button-regular ewb-button-additional" [disabled]="loading" (click)="onOpenResourceBookingModal(row)">
        {{ t('resources.myBookings.rebook') }}
      </button>
    </div>
  </ng-container>
</ng-template>
