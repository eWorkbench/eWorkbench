<!--
  Copyright (C) 2016-2020 TU Muenchen and contributors of ANEXIA Internetdienstleistungs GmbH
  SPDX-License-Identifier: AGPL-3.0-or-later
-->

<ng-container *transloco="let t">
  <div class="metadata-field" *ngFor="let answer of answers.controls; let i = index">
    <div class="flex justify-between">
      <div class="self-center mr-3" *ngIf="showCheckbox()">
        <div class="custom-control custom-checkbox">
          <input
            type="checkbox"
            class="custom-control-input"
            [id]="'checkbox.' + uuid + '.' + i"
            [name]="'checkbox.' + uuid + '.' + i"
            [checked]="selectedValues.includes($any(baseType === 'checkbox' ? id : answers.controls[i].value))"
            [disabled]="!editable"
            (click)="onChanged($any(baseType === 'checkbox' ? id : answers.controls[i].value))"
          />
          <label class="custom-control-label font-normal" [for]="'checkbox.' + uuid + '.' + i"></label>
        </div>
      </div>
      <div class="self-center mr-3" *ngIf="showRadio()">
        <div class="custom-control custom-radio">
          <input
            type="radio"
            class="custom-control-input"
            [id]="'options.' + uuid + '.' + i"
            [name]="'options.' + uuid"
            [value]="answers.controls[i].value"
            [checked]="singleSelected === answers.controls[i].value"
            [disabled]="!editable"
            (click)="onChanged($any(answers.controls[i].value))"
          />
          <label class="custom-control-label" [for]="'options.' + uuid + '.' + i"></label>
        </div>
      </div>
      <div class="flex-fill self-center" *ngIf="baseType !== 'checkbox'">
        <div class="input-group" *ngIf="!datepicker">
          <div class="input-group-prepend">
            <ng-container *ngIf="baseType === 'gps'">
              <span class="input-group-text ewb-input" [class.border-0]="!editable" *ngIf="i === 0">X</span>
              <span class="input-group-text ewb-input" [class.border-0]="!editable" *ngIf="i === 1">Y</span>
            </ng-container>
            <ng-container *ngIf="baseType === 'currency' && typeSettings?.symbol">
              <span class="input-group-text ewb-input" [class.border-0]="!editable">{{ typeSettings?.symbol }}</span>
            </ng-container>
          </div>
          <input
            type="text"
            class="form-control ewb-input"
            [formControl]="answer"
            [id]="'answer-' + uuid + '-' + i"
            [name]="'answer-' + uuid + '-' + i"
            [placeholder]="editable ? labels[i] || '' : t('formInput.notDefined.placeholder')"
            (change)="onChanged()"
            *ngIf="baseType !== 'tag'"
          />
          <ng-select
            class="ewb-select w-100"
            [formControl]="answer"
            [id]="'answer-' + uuid + '-' + i"
            [name]="'answer-' + uuid + '-' + i"
            [placeholder]="editable ? labels[i] || '' : t('formInput.notDefined.placeholder')"
            [multiple]="true"
            [addTag]="addTag"
            [loading]="loading"
            [items]="tags"
            bindLabel="name"
            bindValue="name"
            (change)="onChanged()"
            *ngIf="baseType === 'tag'"
          >
            <ng-template ng-tag-tmp let-search="searchTerm">
              <strong>{{ t('metadata.tag.createNew') }}</strong
              >: {{ search }}
            </ng-template>
          </ng-select>
          <div class="input-group-append" *ngIf="baseType === 'percentage'">
            <span class="input-group-text ewb-input" [class.border-0]="!editable">%</span>
          </div>
        </div>
        <eworkbench-form-date-input
          *ngIf="datepicker"
          [formControl]="answer"
          [inputId]="'answer-' + uuid + '-' + i"
          [inputName]="'answer-' + uuid + '-' + i"
          [datePickerConfig]="datetimePickerConfig"
          [placeholder]="editable ? labels[i] || '' : t('formInput.notDefined.placeholder')"
          (change)="onChanged()"
        ></eworkbench-form-date-input>
      </div>
    </div>
    <div *ngIf="baseType === 'fraction' && i === 0">
      <hr class="p-0 my-2" />
    </div>
  </div>

  <div class="metadata-field" *ngIf="isNotFinal()">
    <div class="flex justify-between">
      <div class="self-center mr-3" *ngIf="showCheckbox()">
        <div class="custom-control custom-checkbox">
          <input
            type="checkbox"
            class="custom-control-input"
            [formControl]="customInputSelectedControl"
            [id]="'checkbox.' + uuid + '.custom'"
            [name]="'checkbox.' + uuid"
          />
          <label class="custom-control-label font-normal" [for]="'checkbox.' + uuid + '.custom'"></label>
        </div>
      </div>
      <div class="self-center mr-3" *ngIf="showRadio()">
        <div class="custom-control custom-radio">
          <input
            type="radio"
            class="custom-control-input"
            [id]="'options.' + uuid + '.custom'"
            [name]="'options.' + uuid"
            [value]="customInputValue"
            [checked]="singleSelected === customInputValue"
            [disabled]="!editable"
            (click)="onChanged(customInputValue)"
          />
          <label class="custom-control-label" [for]="'options.' + uuid + '.custom'"></label>
        </div>
      </div>
      <div class="flex-fill self-center">
        <input
          type="text"
          class="form-control ewb-input"
          [formControl]="customInputControl"
          [id]="'answer.' + uuid + '.custom'"
          [name]="'answer.' + uuid + '.custom'"
          [placeholder]="editable ? t('metadata.field.customInput') : t('formInput.notDefined.placeholder')"
          (change)="onChanged()"
        />
      </div>
    </div>
  </div>
</ng-container>
