<!--
  Copyright (C) 2016-2020 TU Muenchen and contributors of ANEXIA Internetdienstleistungs GmbH
  SPDX-License-Identifier: AGPL-3.0-or-later
-->

<ng-container *transloco="let t">
  <eworkbench-loading [loading]="loading">
    <tabset #stateTimelineTabs class="ewb-tabs">
      <tab [heading]="t('project.stateTimeline.tabHeading.states')">
        <eworkbench-tree-view #statesTreeView [columns]="statesListColumns" [data]="treeData" class="mt-2"></eworkbench-tree-view>
      </tab>
      <tab [heading]="t('project.stateTimeline.tabHeading.timeline')" #timelineTab="tab">
        <eworkbench-gantt-chart
          *ngIf="timelineTab.active"
          [items]="ganttItems"
          [refresh]="renderGantt"
          class="pt-1"
        ></eworkbench-gantt-chart>
      </tab>
    </tabset>
  </eworkbench-loading>
</ng-container>

<ng-template #nameCellTemplate let-row>
  <eworkbench-ellipsis-element class="d-inline-flex" [maxWidth]="300">
    <a [routerLink]="['/projects', row.pk]">{{ row.name }}</a>
  </eworkbench-ellipsis-element>
</ng-template>
<ng-template #progressCellTemplate let-row>
  <ng-container *transloco="let t">
    <eworkbench-project-state [state]="row.project_state" [label]="false" class="float-left mr-2"></eworkbench-project-state>
    <div class="progress" *ngIf="row.tasks_status.NEW + row.tasks_status.PROG + row.tasks_status.DONE">
      <div
        class="progress-bar bg-success"
        role="progressbar"
        [ngStyle]="{ width: progressbarValues(row)[0].label }"
        [tooltip]="
          t('projects.progress.done') +
          ': ' +
          row.tasks_status.DONE +
          ' / ' +
          (row.tasks_status.NEW + row.tasks_status.PROG + row.tasks_status.DONE)
        "
        containerClass="tooltip-sm"
      >
        {{ progressbarValues(row)[0].label }}
      </div>
      <div
        class="progress-bar bg-info"
        role="progressbar"
        [ngStyle]="{ width: progressbarValues(row)[1].label }"
        [tooltip]="
          t('projects.progress.inProgress') +
          ': ' +
          row.tasks_status.PROG +
          ' / ' +
          (row.tasks_status.NEW + row.tasks_status.PROG + row.tasks_status.DONE)
        "
        containerClass="tooltip-sm"
      >
        {{ progressbarValues(row)[1].label }}
      </div>
      <div
        class="progress-bar bg-primary"
        role="progressbar"
        [ngStyle]="{ width: progressbarValues(row)[2].label }"
        [tooltip]="
          t('projects.progress.new') +
          ': ' +
          row.tasks_status.NEW +
          ' / ' +
          (row.tasks_status.NEW + row.tasks_status.PROG + row.tasks_status.DONE)
        "
        containerClass="tooltip-sm"
      >
        {{ progressbarValues(row)[2].label }}
      </div>
    </div>
    <span *ngIf="!(row.tasks_status.NEW + row.tasks_status.PROG + row.tasks_status.DONE)">
      {{ t('projects.noTasks') }}
    </span>
  </ng-container>
</ng-template>
