<div class="row">
    <!-- Show History -->
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <div>
            <label class="control-label" translate>Recent changes</label>

            <span ng-show="!vm.historyLoaded" translate>Please wait...</span>

            <table class="table table-responsive table-hover"
                   style="margin-top: 10px; margin-bottom: 10px; width: 100%;">
                <tbody>
                <tr ng-repeat="history in vm.histories | orderBy: 'date': true"
                    ng-click="vm.toggleHistoryDetails(history)"
                    role="button" popover-placement="bottom-right">
                    <!-- date -->
                    <td style="width: 130px">
                        {{ history.date | smallDateWithToday }}
                    </td>
                    <td>
                        <div>
                            <!-- Insert -->
                            <!-- Model Type | created by | user -->
                            <span ng-if="::history.changeset_type == 'I' ||
                                           history.changeset_type == 'S' ||
                                           history.changeset_type == 'D' ||
                                           history.changeset_type == 'R'"
                                  translate
                                  translate-params-model-name="vm.modelNameToTranslation[history.object_type.model]"
                                  translate-params-history-change-text="vm.historyModelTypeService.historyChangeText[history.changeset_type]"
                            >
                               {{ modelName }}
                               {{ historyChangeText }}
                               by <user-display-widget user="history.user"></user-display-widget>
                            </span>
                            <!-- Update -->
                            <!-- Singular -> Field, Plural -> Fields | field names | edited by | user -->
                            <span ng-if="::history.changeset_type == 'U'">
                                <!-- Singular -> Field, Plural -> Fields -->
                                <span translate translate-n="history.change_records.length"
                                      translate-comment="Field {{ a }} modified by {{ user }}"
                                      translate-plural="Fields">Field</span>
                                <span ng-repeat="change_record in history.change_records">
                                    {{ ::vm.getTranslatedFieldName(change_record.field_name) }}
                                    <!-- Field names -->
                                    <span ng-show="!$last">,</span>
                                </span>
                                {{ vm.historyModelTypeService.historyChangeText[history.changeset_type] }}
                                <span translate translate-comment="Field {{ a }} modified by {{ user }}">by</span>
                                <user-display-widget user="history.user"></user-display-widget>
                            </span>
                        </div>
                        <div uib-collapse="!vm.historyDetailsVisible[history.pk]" ng-if="vm.historyDetailsVisible[history.pk]">
                            <history-entry-widget
                                history="history"
                                change-records="history.change_records"
                                base-url-model="vm.baseUrlModel">
                            </history-entry-widget>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>


            <!-- Depending on viewmode, we either show "Shore more changes" or a pagination -->
            <a class="pull-right clickable"
               tabindex="0"
               ng-show="!vm.expanded && vm.viewMode == 'limited' && vm.showMoreEntries"
               ng-click="vm.showMoreChanges()" role="button" translate>
                Show more changes...
            </a>

            <a class="pull-right clickable"
               tabindex="0"
               ng-show="!vm.expanded && vm.viewMode == 'all'" ng-click="vm.showLessChanges()" role="button" translate>
                Show less changes...
            </a>

            <ul ng-show="vm.viewMode == 'all'" uib-pagination total-items="vm.numberOfChanges" force-ellipses="true"
                ng-model="vm.currentPage" ng-change="vm.pageChanged()"></ul>

        </div>
    </div>
</div>
